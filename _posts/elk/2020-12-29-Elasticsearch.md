---
title: "Elasticsearch란? "
classes: wide
excerpt: "Elasticsearch란?"
header:
  overlay_image: /assets/images/develop-unsplash.jpg
  overlay_filter: rgba(255, 255, 255, 0.3)
categories:
  - elk
  - Elasticsearch
tags:
  - Elasticsearch

last_modified_at: 2020-12-29T13:00:00
---

# Elasticsearch란 ?
Elasticsearch는 텍스트, 숫자, 위치 기반 정보, 정형 및 비정형 데이터를 위한 분산형 오픈 소스 검색 및 분석 엔진이며, Apache Lucene을 기반으로 구축되어 있습니다. 간단한 REST API, 분산형 특징, 속도, 확장성으로 유명한 Elasticsearch는 데이터 수집, 보강, 저장, 분석, 시각화를 위한 Elastic Stack(ELK Stack)의 중심 구성 요소 입니다.

# Elasticsearch 특징
* **오픈소스** - Elasticsearch의 핵심 기능들은 Apache 2.0 라이센스로 배포되고 Elastic Stack의 모든 제품들은 github에서 찾을 수 있습니다. Lucene이 java로 만들어졌기 때문에 Elasticsearch도 Java로 코딩되어 있습니다.

* **실시간 분석** - Elasticsearch 클러스터가 실행되고 있는 동안에는 계속해서 데이터가 입력되고, 그와 동시에 실시간에 가까운 속도로 색인된 데이터의 검색, 집계가 가능합니다.

* **전문(full text) 검색 엔진** - Lucene은 기본적으로 역파일 색인 구조로 데이터를 저장하며, Elasticsearch도 마찬가지로 색인된 모든 데이터를 역파일 색인 구조로 저장하여 가공된 텍스트를 검색하고, 이런 특성을 전문 검색이라합니다.

* **REST API** - Elasticsearch는 REST API를 기본으로 지원하며 모든 데이터 조회, 입력, 삭제를 http 프로토콜을 통해 처리합니다.

* **멀티테넌시 (multitenancy)** - Elasticsearch의 데이터들은 인덱스(Index)라는 논리적인 집합 단위로 구성되며 서로 다른 저장소에 분산되어 저장됩니다. 서로 다른 인덱스들을 별도의 커넥션 없이 하나의 질의로 묶어서 검색하고, 검색 결과들을 하나의 축력으로 도출할 수 있는데 이러한 특징을 멀티테넌시라고 합니다.

# 주요 용어
* **색인(indexing)** - 데이터가 검색될 수 있는 구조로 변경하기 위한 원본 문서를 검색어 토큰들로 변환하여 저장하는 일련의 과정.

* **인덱스(index, indices)** - 색인 과정을 거친 결과물, 또는 색인된 데이터가 저장되는 저장소. 또한 Elasticsearch에서 Document들의 논리적인 집합을 표현하는 단위.

* **검색(search)** - 인덱스에 들어있는 검색어 토큰들을 포함하고 있는 문서를 찾아가는 과정.

* **질의(query)** - 사용자가 원하는 문서를 찾거나 집계 결과를 출력하기 위해 검색 시 입력하는 검색어 도는 검색 조건.

### 논리적 용어

* **Document** - Elastic 데이터 최소 단위(RDB의 Table)이며, JSON 오브젝트 하나를 뜻합니다. 다양한 필드로 그성되어 있고, 이 필드에는 데이터 필드에 해당하는 데이터 타입이 들어가며, 중첩구조를 지원하기 때문에 Document 안에 Document가 들어가는 것도 가능함.

* **Type** - 여러개의 Document가 모여 하나의 Type(RDB의 Table)을 이루며, Elasticsearch 7.0부터 Type이 완전히 사라졌으며, Index가 RDB의 Table과 Database역할을 하고 있음.

* **Field** - Document에 들어있는 데이터 타입(RDB의 Column)과 비슷하지만 필드는 동적으로 구성될 수 있으며, 하나의 Field가 여러개의 데이터 타입을 가질 수 있음.

* **Mapping** - 필드와 필드의 속성을 정의하고 색인 방법을 정의하며, 매핑 정보에 여러가지 데이터 타입 지정이 가능하지만 필드명 자체는 중복이 불가능함.

* **Index** - 여러개의 Type이 모여 하나의 Index(RDB의 테이블)를 이루었지만, Elasticsearch 6.1부터는 하나의 Index는 하나의 Type만 가질 수 있기 때문에 Database + Table의 역할. Elasticsearch를 클러스터(분산환경)으로 구성했을 경우 Index는 여러 노드에 분산 저장/관리된다. 기본설정은 5개의 프라이머리 샤드(Prmiary Shard)와 1개의 레플리카 샤드(Replica Shard)를 생성한다. 샤드 수는 인덱스 생성 시 옵션 값을 이용하여 변경 가능함.

### 물리적 용어

* **노드** - 노드는 Elasticsearch 클러스터에 포함된 단일 서버로서 데이터를 저장하고 클러스터의 색인화 및 검색 기능에 참여하며, 클러스터처럼 이름으로 식별되고 특정 이름으로 정의할 수 있음.

    * **마스터 노드** - 클러스터 관리 노드, 노드 추가/제거, 인덱스 생성/삭제등 클러스터의 전반적 관리 담당. 
    * **데이터 노드** - Document가 저장되는 노드. 데이터가 분산 저장되는 물리적인 공간인 샤드가 배치되는 노드. 색인/검색/통계 등 데이터 작업 수행(리소스가 많이 필요하며 모니터링 필수). 마스터와 분리 필요.
    * **코디네이팅 노드** - 사용자의 요청을 받고 라운드로빈 방식으로 분산시켜주는 노드. 클러스터에 관련된 것은 마스터 노드로 넘기고 데이터 관련된 것은 데이터 노드로 보냄.
    * **인제스트 노드** - 문서 전처리 작업 수행 인덱스 생성 전 문서의 형식 변경을 다양하게 할 수 있음.

* **샤드** - Index 내부에는 색인도니 데이터들이 존재하는데 이 데이터들을 물리적 공간에 여러개의 부분들로 나뉘어서 존재하는데 이를 샤드라고 함.

    * **프라이머리 샤드** - 데이터의 원본. 
    * **레플리카 샤드** - 프라이머리 샤드의 본제본. 기존 원본에 문제가 생겼을 때 대신 쓰이면서 장애 극복 역할을 수행함. 기본적으로 프라이머리 샤드와 동일한 노드에 배정되지 않음.

* **세그먼트** - 세그먼트란 Elasticsearch에서 문서의 빠른 검색을 위해 설계된 자료구조이며, 각 샤드는 다수의 세그먼트로 구성되어 있음. Document를 저장하면 이것을 메모리에 모아두고 새로운 세그먼트를 디스크에 기록하여 검색을 새로고침하며, 이로 인해 새로운 검색 가능한 세그먼트가 만들어지게 됨.

    * **세그먼트 병합이란 ?** - 세그먼트는 불변의 성질을 가지고 있기 때문에 데이터가 업데이트되면 실제로는 삭제되었다고 마크만 하고 새로운 데이터를 가르킨다. 그리고 삭제되었다고 마크된 데이터는 디스크에 남아있다가 백그라운드에서 주기적으로 정리되고, 새로운 세그먼트로 병합한 후 세그먼트를 삭제하며 비로소 디스크에서 완전히 삭제되는 작업을 세그먼트 병합이라고 합니다.

|관계형 데이터베이스|Elasticsearch|
|---|---|
|Database|Index|
|Table|Type|
|Row|Document|
|Column|Field|
|Schema|Mapping|
|Index|Everthing is indexed|
|SQL|Query|